var e;e=function(){var e=function(){function t(e){return i.appendChild(e.dom),e}function n(e){for(var t=0;t<i.children.length;t++)i.children[t].style.display=t===e?"block":"none";r=e}var r=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",function(e){e.preventDefault(),n(++r%i.children.length)},!1);var a=(performance||Date).now(),o=a,s=0,l=t(new e.Panel("FPS","#0ff","#002")),c=t(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=t(new e.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:i,addPanel:t,showPanel:n,begin:function(){a=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(c.update(e-a,200),e>o+1e3&&(l.update(1e3*s/(e-o),100),o=e,s=0,u)){var t=performance.memory;u.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){a=this.end()},domElement:i,setMode:n}};return e.Panel=function(e,t,n){var r=1/0,i=0,a=Math.round,o=a(window.devicePixelRatio||1),s=80*o,l=48*o,c=3*o,u=2*o,d=3*o,f=15*o,h=74*o,p=30*o,y=document.createElement("canvas");y.width=s,y.height=l,y.style.cssText="width:80px;height:48px";var w=y.getContext("2d");return w.font="bold "+9*o+"px Helvetica,Arial,sans-serif",w.textBaseline="top",w.fillStyle=n,w.fillRect(0,0,s,l),w.fillStyle=t,w.fillText(e,c,u),w.fillRect(d,f,h,p),w.fillStyle=n,w.globalAlpha=.9,w.fillRect(d,f,h,p),{dom:y,update:function(l,v){r=Math.min(r,l),i=Math.max(i,l),w.fillStyle=n,w.globalAlpha=1,w.fillRect(0,0,s,f),w.fillStyle=t,w.fillText(a(l)+" "+e+" ("+a(r)+"-"+a(i)+")",c,u),w.drawImage(y,d+o,f,h-o,p,d,f,h-o,p),w.fillRect(d+h-o,f,o,p),w.fillStyle=n,w.globalAlpha=.9,w.fillRect(d+h-o,f,o,a((1-l/v)*p))}}},e},"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):this.Stats=e(),function(){var e=window;const n=320,r=200,i=n*r,a=i,o=2*i,s=9*i,l=Math;Object.getOwnPropertyNames(l).forEach(t=>e[t]=e[t]||l[t]),viewX=0,viewY=0,viewW=n,viewH=r,cursorX=0,cursorY=0,cursorColor=22,cursorColor2=0,floodStack=[],fontString="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_!@#.'\"?/<()",fontBitmap="11111100011111110001100011111010001111101000111110111111000010000100000111111100100101000110001111101111110000111001000011111111111000011100100001000011111100001011110001111111000110001111111000110001111110010000100001001111111111000100001010010111101000110010111001001010001100001000010000100001111110001110111010110001100011000111001101011001110001011101000110001100010111011110100011001011100100000111010001100011001001111111101000111110100011000101111100000111000001111101111100100001000010000100100011000110001100010111010001100011000101010001001000110001101011010101110100010101000100010101000110001010100010000100001001111100010001000100011111001000110000100001000111001110100010001000100111111111000001001100000111110100101001011111000100001011111100001111000001111100111110000111101000101110111110000100010001000010001110100010111010001011100111010001011110000101110011101000110001100010111000000000000000000000111110010000100001000000000100111111000110111101011011101010111110101011111010100000000000000000000000100001100001000100000000000011011010011001000000000000111010001001100000000100000010001000100010001000000010001000100000100000100001000100001000010000010",dither=[65535,65527,65015,65013,62965,62901,58805,58789,42405,42401,42145,42144,41120,40992,32800,32768,0],pat=65535,palDefault=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63];var c=document.getElementById("canvas"),u=(document.createElement("canvas").getContext("2d"),c.getContext("2d")),d=0,f=o,p=[4278715910,4279439380,4280620859,4281145203,4280950964,4280499935,4278872826,4280001529,4282504703,4282449151,4284805846,4282637212,4281712985,4281245716,4282284570,4282077732,4280295442,4284757012,4291058728,4292779812,4291286560,4292607142,4294967295,4290835454,4290303738,4288127221,4285754088,4288367292,4286593657,4283642688,4281606692,4279901218,4280822578,4282073457,4282873275,4284720347,4288467700,4293583066,4291934643,4289696651,4287460717,4284634186,4282464563,4281541698,4281872731,4283585166,4285167034,4288919017,4294960867,4294688697,4293172100,4290678104,4286938439,4283328291,4284777522,4287475549,4290436242,4293064653,4289385188,4287344839,4284647072,4283787129,4282666586,4281612610];pal=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63],u.imageSmoothingEnabled=!1,c.width=n,c.height=r;var w=u.getImageData(0,0,n,r),v=new ArrayBuffer(w.data.length),x=new Uint8Array(v),g=new Uint32Array(v),m=new Uint8Array(n*r*20);function I(e,t,i=64){return!(0-i>e||e>n+i||0-i>t||t>r+i)}function C(e=0,t=d){m.fill(e,t,t+i)}function D(e=cursorColor,t=cursorColor2){cursorColor=e,cursorColor2=t}function E(e,t){let i=(t|=0)%4*4+(e|=0)%4,a=pat&Math.pow(2,i),o=a?cursorColor:cursorColor2;o>63&&(o=0),0>e|e>n-1||0>t|t>r-1||(m[d+t*n+e]=a?cursorColor:cursorColor2)}function S(e,t,n,r,i=cursorColor,a=cursorColor2){cursorX=n,cursorY=r,cursorColor2=a,cursorColor=i;var o,s,l=(r|=0)-(t|=0),c=(n|=0)-(e|=0);if(0>l?(l=-l,s=-1):s=1,0>c?(c=-c,o=-1):o=1,l<<=1,c<<=1,E(e,t),c>l)for(var u=l-(c>>1);e!=n;)0>u||(t+=s,u-=c),u+=l,E(e+=o,t);else for(u=c-(l>>1);t!=r;)0>u||(e+=o,u-=l),u+=c,E(e,t+=s)}function O(e,t,n=16,r=16,i=cursorColor,a=cursorColor2){cursorColor2=a,cursorColor=i,x1=0|e,y1=0|t,n|=0,r|=0,S(x1,y1,n,y1,i),S(n,y1,n,r,i),S(x1,r,n,r,i),S(x1,y1,x1,r,i)}function R(e,t,n=16,r=16,i=cursorColor,a=cursorColor2){cursorColor2=a,cursorColor=i,x1=0|e,y1=0|t,n|=0,i|=0;var o=(r|=0)-y1;if(S(x1,y1,n,y1,i),o>0)for(;--o;)S(x1,y1+o,n,y1+o,i);else if(0>o)for(;++o;)S(x1,y1+o,n,y1+o,i);S(x1,r,n,r,i)}function M(e=0,t=0,i=n,a=r,o=0,s=0,l=!1,c=!1,u=pal){e|=0,t|=0,i|=0,a|=0,o|=0,s|=0;for(var h=0;a>h;h++)for(var p=0;i>p;p++)r>s+h&&n>o+p&&s+h>-1&&o+p>-1&&(l&c?0>m[f+((t+(a-h))*n+e+(i-p))]||(m[d+((s+h)*n+o+p)]=u[m[f+((t+(a-h-1))*n+e+(i-p-1))]]):c&&!l?0>m[f+((t+(a-h))*n+e+p)]||(m[d+((s+h)*n+o+p)]=u[m[f+((t+(a-h-1))*n+e+p)]]):l&&!c?0>m[f+((t+h)*n+e+(i-p-1))]||(m[d+((s+h)*n+o+p)]=u[m[f+((t+h)*n+e+(i-p-1))]]):l||c||0>m[f+((t+h)*n+e+p)]||(m[d+((s+h)*n+o+p)]=u[m[f+((t+h)*n+e+p)]]))}function K(e){e[7]||(e[7]=1),e[8]||(e[8]=1);for(var n=e[0].length,r=0;n>r;r++){var i;s=e[0].charAt(r),index=fontString.indexOf(s),i=fontBitmap.substring(25*index,25*index+25).split("");for(var a=0;5>a;a++)for(var o=0;5>o;o++)if(1==i[5*a+o])if(1==e[4])E(e[1]+o*e[4]+(5*e[4]+e[3])*r,e[2]+(e[6]?Math.sin(1*(t+r*e[8])/e[7])*e[6]:0)+a*e[4]|0);else{let n=e[1]+o*e[4]+(5*e[4]+e[3])*r,i=e[2]+(e[6]?Math.sin(1*(t+r*e[8])/e[7])*e[6]:0)+a*e[4]|0;R(n,i,n+e[4],i+e[4],e[5])}}var s}function b(e){var t=5*e[7],n=e[0].split("\n"),r=n.slice(0),i=n.length,a=r.sort(function(e,t){return t.length-e.length})[0],o=a.length*t+(a.length-1)*e[3],s=i*t+(i-1)*e[4];e[5]||(e[5]="left"),e[6]||(e[6]="bottom");var l=e[1],c=e[2],u=e[1]+o,d=e[2]+s;"center"==e[5]?(l=e[1]-o/2,u=e[1]+o/2):"right"==e[5]&&(l=e[1]-o,u=e[1]),"center"==e[6]?(c=e[2]-s/2,d=e[2]+s/2):"bottom"==e[6]&&(c=e[2]-s,d=e[2]);for(var f=l+o/2,h=c+s/2,p=0;i>p;p++){var y=n[p],w=y.length*t+(y.length-1)*e[3],v=e[1],x=e[2]+(t+e[4])*p;"center"==e[5]?v=e[1]-w/2:"right"==e[5]&&(v=e[1]-w),"center"==e[6]?x-=s/2:"bottom"==e[6]&&(x-=s),K([y,v,x,e[3]||0,e[7]||1,e[8],e[9],e[10],e[11]])}return{sx:l,sy:c,cx:f,cy:h,ex:u,ey:d,width:o,height:s}}function Y(e=Date.now(),t=1664525,n=1013904223,r=Math.pow(2,32)){this.seed=e,this.a=t,this.c=n,this.m=r}audioCtx=new AudioContext,Number.prototype.clamp=function(e,t){return Math.min(Math.max(this,e),t)},Number.prototype.map=function(e,t,n,r){return(this-e)/(t-e)*(r-n)+n},Number.prototype.pad=function(e,t="0"){for(var n=String(this);n.length<(e||2);)n=t+n;return n},Key={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,ONE:49,TWO:50,THREE:51,FOUR:52,a:65,c:67,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,isDown(e){return this._pressed[e]},justReleased(e){return this._released[e]},onKeydown(e){this._pressed[e.keyCode]=!0},onKeyup(e){this._released[e.keyCode]=!0,delete this._pressed[e.keyCode]},update(){this._released={}}},Y.prototype.setSeed=function(e){this.seed=e},Y.prototype.nextInt=function(){return this.seed=(this.seed*this.a+this.c)%this.m,this.seed},Y.prototype.nextFloat=function(){return this.nextInt()/this.m},Y.prototype.nextBool=function(e){return null==e&&(e=.5),this.nextFloat()<e},Y.prototype.nextFloatRange=function(e,t){return e+this.nextFloat()*(t-e)},Y.prototype.nextIntRange=function(e,t){return Math.floor(this.nextFloatRange(e,t))},Y.prototype.nextColor=function(){for(var e=this.nextIntRange(0,Math.pow(2,24)).toString(16).toUpperCase();6>e.length;)e="0"+e;return"#"+e};var X=function(){var e,t,n,r,i,a=function(e){return Math.sin(6.283184*e)},o=function(e){return.003959503758*Math.pow(2,(e-128)/12)},s=function(e,t,n){var r,i,a,s,c,u,d,f=l[e.i[0]],h=e.i[1],p=e.i[3],y=l[e.i[4]],w=e.i[5],v=e.i[8],x=e.i[9],g=e.i[10]*e.i[10]*4,m=e.i[11]*e.i[11]*4,I=e.i[12]*e.i[12]*4,C=1/I,D=e.i[13],E=n*Math.pow(2,2-e.i[14]),S=new Int32Array(g+m+I),O=0,R=0;for(r=0,i=0;g+m+I>r;r++,i++)0>i||(i-=E,u=o(t+(15&(D=D>>8|(255&D)<<4))+e.i[2]-128),d=o(t+(15&D)+e.i[6]-128)*(1+8e-4*e.i[7])),a=1,g>r?a=r/g:g+m>r||(a-=(r-g-m)*C),s=u,p&&(s*=a*a),c=f(O+=s)*h,s=d,v&&(s*=a*a),c+=y(R+=s)*w,x&&(c+=(2*Math.random()-1)*x),S[r]=80*c*a|0;return S},l=[a,function(e){return.5>e%1?1:-1},function(e){return e%1*2-1},function(e){var t=e%1*4;return 2>t?t-1:3-t}];this.init=function(a){e=a,t=a.endPattern,n=0,r=a.rowLen*a.patternLen*(t+1)*2,i=new Int32Array(r)},this.generate=function(){var o,c,u,d,f,h,p,y,w,v,x,g,m,I,C=new Int32Array(r),D=e.songData[n],E=e.rowLen,S=e.patternLen,O=0,R=0,M=!1,K=[];for(u=0;t>=u;++u)for(p=D.p[u],d=0;S>d;++d){var b=p?D.c[p-1].f[d]:0;b&&(D.i[b-1]=D.c[p-1].f[d+S]||0,16>b&&(K=[]));var Y=l[D.i[15]],X=D.i[16]/512,A=Math.pow(2,D.i[17]-9)/E,L=D.i[18],P=D.i[19],T=43.23529*D.i[20]*3.141592/44100,G=1-D.i[21]/255,N=1e-5*D.i[22],F=D.i[23]/32,z=D.i[24]/512,k=6.283184*Math.pow(2,D.i[25]-9)/E,j=D.i[26]/255,H=D.i[27]*E&-2;for(x=(u*S+d)*E,f=0;4>f;++f)if(h=p?D.c[p-1].n[d+f*S]:0){K[h]||(K[h]=s(D,h,E));var U=K[h];for(c=0,o=2*x;c<U.length;c++,o+=2)C[o]+=U[c]}for(c=0;E>c;c++)(v=C[y=2*(x+c)])||M?(g=T,L&&(g*=Y(A*y)*X+.5),R+=(g=1.5*Math.sin(g))*(m=G*(v-R)-(O+=g*R)),v=3==P?R:1==P?m:O,N&&(v=1>(v*=N)?v>-1?a(.25*v):-1:1,v/=N),M=(v*=F)*v>1e-5,I=v*(1-(w=Math.sin(k*y)*z+.5)),v*=w):I=0,H>y||(I+=C[y-H+1]*j,v+=C[y-H]*j),C[y]=0|I,C[y+1]=0|v,i[y]+=0|I,i[y+1]+=0|v}return++n/e.numChannels},this.createWave=function(){var e=44+2*r-8,t=e-36,n=new Uint8Array(44+2*r);n.set([82,73,70,70,255&e,e>>8&255,e>>16&255,e>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&t,t>>8&255,t>>16&255,t>>24&255]);for(var a=0,o=44;r>a;++a){var s=i[a];s=-32767>s?-32767:s>32767?32767:s,n[o++]=255&s,n[o++]=s>>8&255}return n},this.getBuffer=function(){return i},this.getData=function(e,t){for(var n=2*Math.floor(44100*e),r=new Array(t),a=0;2*t>a;a+=1){var o=n+a;r[a]=e>0&&o<i.length?i[o]/32768:0}return r}},A={songData:[{i:[3,138,116,0,0,138,128,4,0,0,47,48,166,124,3,0,139,4,1,3,64,160,3,32,147,4,121,5],p:[1,1,4,2,3],c:[{n:[111],f:[]},{n:[114],f:[]},{n:[113],f:[]},{n:[112,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,113],f:[]}]}],rowLen:5513,patternLen:32,endPattern:4,numChannels:1};function L(e,n,r){this.x=e+2,this.y=n+2,this.width=16,this.height=16,this.health=r,this.facingLeft=!0,this.following=!1,this.draw=function(){let e=this.x-viewX,n=this.y-viewY,r=t%30>15;I(e,n,24)&&(R(e,n-r,e+this.width,n+this.height,0,0),O(e,n-r,e+this.width,n+this.height,17,17),R(e+3,n+3,e+6,n+4,22,22),this.following&&R(e,n,e+this.width,n+this.height,7,0))},this.update=function(){let e=this.x-viewX,n=this.y-viewY;this.following=!1;let r=t%30>0;if(I(e,n,24)){this.x+=random()>.5?r:-r,this.y+=random()>.5?r:-r;let e=player.x-this.x,t=player.y-this.y,n=sqrt(t*t+e*e),i=atan2(t,e);100>n&&(this.following=!0,this.x+=cos(i),this.y+=sin(i))}}}player={x:480,y:240,oldX:0,oldY:0,vx:2,vy:2,width:6,height:10,color:12,gravity:gravity=4,tx:0,ty:0,steps:0,gid:0,draw:function(e){let t=this.x-viewX,n=this.y-viewY,r=this.steps%28>14?0:1,i=this.steps%40>20?0:1;R(t+1,n+i,t+5,n+4+i,22,22),R(t,n+1+i,t+this.width,n+3+i),R(t+2,n+2,t+4,n+8),E(t,n+7),E(t+6,n+7),S(t+1,n+6,t+5,n+6),S(t+1,n+9,t+1,n+10+r),S(t+5,n+9,t+5,n+10+!r)},update:function(){player.oldX=player.x,player.oldY=player.y,Key.isDown(Key.d)||Key.isDown(Key.RIGHT)?(player.x+=player.vx,this.steps++):(Key.isDown(Key.a)||Key.isDown(Key.LEFT)||Key.isDown(Key.q))&&(player.x-=player.vx,this.steps++),Key.isDown(Key.w)||Key.isDown(Key.UP)||Key.isDown(Key.z)?(player.y-=player.vy,this.steps++):(Key.isDown(Key.s)||Key.isDown(Key.DOWN))&&(player.y+=player.vy,this.steps++),1!=getGID(player.x,player.y)&&1!=getGID(player.x+player.width-1,player.y)&&1!=getGID(player.x+player.width-1,player.y+player.height-1)&&1!=getGID(player.x,player.y+player.height-1)||(player.xVel=0,player.x=player.oldX,player.y=player.oldY),Key.justReleased(Key.x)&&(2==getGID(player.x,player.y)||2==getGID(player.x+player.width-1,player.y)||2==getGID(player.x+player.width-1,player.y+player.height-1)||2==getGID(player.x,player.y+player.height-1))&&(foundSwitch=switches.find(function(e){return e.index==getIndex(player.x,player.y)}),foundSwitch&&(foundSwitch.state=1))}},switches=[],enemies=[],objects=[],states={},lcg=new Y(1019),init=(()=>{stats=new Stats,stats.showPanel(1),document.body.appendChild(stats.dom),drawMap(),createSwitches(),spawnEnemies(),state="menu",last=0,t=0,audioCtx=new AudioContext,audioMaster=audioCtx.createGain(),audioMaster.connect(audioCtx.destination),deadzoneX=70,deadzoneY=70,viewX=player.x-n/2,viewY=player.y-r/2,sounds={},music=new X,music.init(A),done=!1,setInterval(function(){done||(done=1==music.generate(),done&&(wave=music.createWave().buffer,audioCtx.decodeAudioData(wave,function(e){sounds.song=e,function(e,t=1,n=0,r=.5,i=!1){var a=audioCtx.createBufferSource(),o=audioCtx.createGain(),s=audioCtx.createStereoPanner();a.buffer=e,a.connect(s),s.connect(o),o.connect(audioMaster),a.playbackRate.value=t,a.loop=i,o.gain.value=r,s.pan.value=n,a.start()}(sounds.song,1,0,.5,!0)})))},0),paused=!1,loop()}),window.addEventListener("keyup",function(e){Key.onKeyup(e)},!1),window.addEventListener("keydown",function(e){Key.onKeydown(e)},!1),window.addEventListener("blur",function(e){paused=!0},!1),window.addEventListener("focus",function(e){paused=!1},!1),loop=(e=>{stats.begin(),paused?(D(22,22),d=0,b(["PAUSED",n/2,128,3,1,"center","top",3,21,0]),audioMaster.gain.value=0):(dt=1,t+=1,audioMaster.gain.value=1,states[state].step(1),states[state].draw()),Key.update(),function(){let e=i;for(;e--;)g[e]=p[pal[m[e]]];w.data.set(x),u.putImageData(w,0,0)}(),stats.end(),requestAnimationFrame(loop)}),drawMap=(t=>{d=s,D(1,1),R(0,0,n,r,1,1);for(let t=0;900>t;t++){let t=lcg.nextIntRange(5,n-5),i=lcg.nextIntRange(5,r-5);e=lcg.nextIntRange(3,12),h=lcg.nextIntRange(3,12),R(t,i,t+e,i+h,0,0)}for(let e=0;10>e;e++){let t=10;y=e*(r-10)/10+5,R(t,y,t+n-30,y+1,0,0)}R(0,0,n,5,1,1),R(0,0,5,r,1,1),R(n-5,0,n,r,1,1),R(0,r-5,5,r,1),d=0}),createSwitches=(e=>{for(let e=0;10>e;e++){var t=lcg.nextIntRange(6,20),n=lcg.nextIntRange(13,16);d=s,D(2,2),E(t,n),d=0,switches.push({x:t,y:n,index:getIndex(24*t,24*n),color:[7,7,28,18][lcg.nextIntRange(0,3)],state:0})}}),drawSwitches=(e=>{switches.forEach(function(e){var t=24*e.y-viewY,n=24*e.x-viewX;if(I(n,t,24))switch(d=0,e.state){case 2:break;case 1:t=24*e.y-viewY,R(2+(n=24*e.x-viewX),t+2,n+24-2,t+24-2,e.color,0);break;default:t=24*e.y-viewY,R(2+(n=24*e.x-viewX),t+2,n+24-2,t+24-2,0,2)}})}),getIndex=((e,t)=>s+(e/24|0)+320*(t/24|0)),getGID=((e,t)=>m[getIndex(e,t)]),drawObjects=(e=>{objects.forEach(function(e){e.draw()})}),updateObjects=(e=>{objects.forEach(function(e){e.update()})}),spawnEnemies=(e=>{for(let e=0;200>e;e++){let e=lcg.nextIntRange(5,100),t=lcg.nextIntRange(5,100);0==getGID(24*e,24*t)&&enemies.push(new L(24*e,24*t,10))}}),objects.push({x:120,y:120,complete:!1,Off1:"TUTORIAL......OFFLINE",On1:"TUTORIAL......ONLINE",Off2:"FLIP SWITCHES TO\nBRING SYSTEMS ONLINE",On2:"GOOD LITTLE HELPER.\nPROCEED TO NEXT ROOM",Off3:"",On3:"DOOMSDAY AI....OFFLINE",update:function(){this.complete=switches.filter(e=>7==e.color).every(e=>1==e.state)},draw:function(){let e=this.x-viewX,t=this.y-viewY;I(e,t,n)&&(R(e-10,t-10,e+140,t+80,1,1),D(22,22),b([this.On1+"\n"+(this.complete?this.On2:this.Off2)+"\n"+(.8>random()?this.Off3:this.On3),e,t,1,9,"left","top",1,22,0]))}}),states.menu={step:function(e){Key.justReleased(Key.SPACE)&&(state="game")},draw:function(e){d=0,C(0),f=s,mapPal=[2,7],M(0,0,n,r,0,0,0,0,mapPal)}},states.game={step:function(e){player.update(e),player.x-viewX+deadzoneX>viewW?viewX=player.x-(viewW-deadzoneX):player.x-deadzoneX<viewX&&(viewX=player.x-deadzoneX),player.y-viewY+deadzoneY>viewH?viewY=player.y-(viewH-deadzoneY):player.y-deadzoneY<viewY&&(viewY=player.y-deadzoneY),enemies.forEach(function(e){e.update()})},draw:function(e){pat=dither[8],d=a,C(0),R(0,0,n,r,2),d=0,C(0);let t=viewX/24-3|0,i=(viewX+n)/24+3|0,o=viewY/24-3|0,l=(viewY+r)/24+3|0;for(let e=t;i>e;e++)for(let t=o;l>t;t++){let n,r;switch(m[s+320*t+e]){case 1:R(1+(n=24*e-viewX),1+(r=24*t-viewY),n+24-1,r+24-1,8,7),O(n,r,n+24+1,r+24+1,6,7);break;case 2:break;default:R(n=24*e-viewX,r=24*t-viewY,n+24,r+24,2,1),O(n,r,n+24,r+24,2,3)}}enemies.forEach(function(e){e.draw()}),player.draw(),R(n-60,r-60,n-5,r-5,0,0),O(n-60,r-60,n-5,r-5,22,22),f=s,mapPal=[1,7],M(t-18,o-18,54,54,n-59,r-59,0,0,mapPal),D(22,22),E((player.x-viewX)/24+n-56+18,(player.y-viewY)/24+r-56+18)}},window.init()}();